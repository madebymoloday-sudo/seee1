# Как использовать программы психолога

## Структура

Все программы психолога хранятся в папке `programs/psychologist/` в формате JSON.

## Формат программы

Каждый JSON файл должен содержать:

```json
{
  "name": "название_программы",
  "version": "1.0.0",
  "description": "Описание программы",
  "steps": {
    "step_name": {
      "question": "Вопрос для пользователя (или null)",
      "systemPrompt": "Промпт для GPT с переменными {variable}"
    }
  },
  "variables": {
    "variable": "Описание переменной"
  },
  "settings": {
    "temperature": 0.7,
    "maxTokens": 500,
    "model": "gpt-4o-mini"
  }
}
```

## Добавление новой программы

1. Создайте новый JSON файл в `programs/psychologist/`
2. Название файла должно совпадать с полем `name` в JSON
3. Перезапустите сервер (в dev режиме - автоматически перезагрузится)

## Использование программы

### При создании сессии

```json
POST /api/v1/sessions
{
  "title": "Моя сессия",
  "programName": "default"
}
```

### Получить список программ

```bash
GET /api/v1/psychologist/programs
```

### Получить конкретную программу

```bash
GET /api/v1/psychologist/programs/default
```

## Переменные в промптах

В `systemPrompt` можно использовать переменные:
- `{problem}` - проблема пользователя
- `{emotion}` - эмоция пользователя
- `{thought}` - мысль пользователя
- `{whyAnswer}` - ответ на вопрос "Почему?"
- `{botIdeas}` - идеи, предложенные ботом
- `{founder}` - основатель идеи
- `{purposeOptions}` - варианты целей
- `{consequences}` - последствия

## Примеры программ

- `default.json` - стандартный 9-шаговый пайплайн
- Можно создать `short.json` - сокращенный пайплайн
- Можно создать `deep.json` - углубленный пайплайн

## Важно

- Каждая сессия сохраняет `programName` в своем состоянии пайплайна
- Программа загружается автоматически при обработке сообщения
- Настройки LLM (temperature, model) берутся из программы
- В development режиме программы перезагружаются автоматически

